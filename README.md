# Broker demo for gitlab local
[_] Snyk broker demo set up
* [done][2022/07/13] set up local GitLab (docker)
    * https://qiita.com/suzukihi724/items/55de461d8cdfa3459f11
    * https://docs.gitlab.com/ee/install/docker.html
    * https://hub.docker.com/r/yrzr/gitlab-ce-arm64v8
    * M1 Macの場合、Arm64で作られたコンテナじゃないと動かないっぽい？
* Gitlab container registryの有効化
    * GitLab をインストールしよう! (omnibus package) - Qiita「
    * Root passwdの取得
        * https://mebee.info/2022/04/15/post-65562/
        * docker exec -it gitlab grep 'Password:' /etc/gitlab/initial_root_password

[_] HTTPS
* https://docs.gitlab.com/omnibus/settings/nginx.html#manually-configuring-https
    * Certs generated by Mac’s keychain access
        * Needs to translate der to pem 
            * How do I convert a .cer certificate to .pem? - Server Fault
                * openssl x509 -inform der -in certificate.cer -outform pem -out certificate.pem
            * Also private key as well
                * Converting PKCS#12 certificate into PEM using OpenSSL - Stack Overflow
    * Install and configure the Snyk Broker client
        * Brokerに以下の設定が必要（自己証明書のため）
            * -e CA_CERT=/private/ca.cert.pem \  # GitLabの証明書
            * -e NODE_TLS_REJECT_UNAUTHORIZED=0　　＃TLSチェック無効化

[done] SCM Broker setup
* https://docs.google.com/presentation/d/1Kigk2FTKDEHB0-5kjh24g8wkxIGV_v6A0MxwSFVETzQ/edit#slide=id.g7f87d73857_0_125
    * [done] SCM connection
    * [done] ローカル環境からGitLabのRepoにアクセスできる確認

[____] Container registry
* GitLab Container Registry を有効化して、Dockerから利用する - Qiita
